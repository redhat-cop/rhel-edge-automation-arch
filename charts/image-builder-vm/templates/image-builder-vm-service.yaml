{{- range $pool := .Values.imageBuilderPools }}
{{- range $i, $e := until ($pool.replicas | int) }}
{{- $instance_name := printf "image-builder-pool-%s-%03d" $pool.name $i }}
---
apiVersion: v1
kind: Service
metadata:
  labels:
    vm.kubevirt.io/name: {{ $instance_name }}
    {{- include "common.labels.labels" $ | nindent 4 }}
  name: {{ $instance_name }}
  namespace: rfe
spec:
  ports:
  - name: 22-tcp
    port: 22
    protocol: TCP
    targetPort: 22
  - name: 9090-tcp
    port: 9090
    protocol: TCP
    targetPort: 9090
  selector:
    vm.kubevirt.io/name: {{ $instance_name }}
  sessionAffinity: None
  type: ClusterIP
{{- end }}
{{- end }}
